
# 壓力測試報告

## 1. 測試目標與範圍
- **測試目標**：
    - 驗證CDC（客戶資料檢核）批次作業的性能，特別是優化後的自動結案預存程式（DBCHK_ProcessDetectionResults）。
    - 分析CDC批次作業與ETL作業、線上姓名檢核API並行運行時的系統穩定性及響應時間。
- **測試範圍**：
    - 全行客戶AML姓名檢核及營業中案件的結案動作。
    - 線上姓名檢核API響應時間及SQL Server資料庫的LOCK Wait Type情況。

## 2. 測試環境描述
- **硬體環境**：
    - 伺服器配置：CPU 16核心，內存64GB，磁碟IOPS 20,000以上。
    - 資料庫伺服器：SQL Server 2016。
- **軟體環境**：
    - 操作系統：Windows Server 2016。
    - 測試工具：POSTMAN進行API測試，ETL工具使用Pentaho。
- **測試工具**：
    - 使用POSTMAN進行線上API的壓力測試。
    - 使用Pentaho進行ETL作業。

## 3. 測試方法與設計
- **測試場景**：
    1. **CDC（客戶資料檢核）批次作業**：模擬全行客戶資料進行AML姓名檢核，同時執行自動結案程式。
    2. **ETL作業**：使用Pentaho進行資料匯入及處理。
    3. **線上姓名檢核API**：使用POSTMAN模擬大量並發線上檢核請求，檢測響應時間及LOCK Wait Type情況。
- **測試數據**：
    - 測試數據為實際客戶資料的抽樣數據集，並加入隨機生成的模擬數據。
- **測試步驟**：
    1. 啟動CDC批次作業，同步執行ETL作業。
    2. 使用POSTMAN工具發送API請求，模擬大量分行線上姓名檢核操作。
    3. 觀察系統資源占用率、批次作業完成時間、API響應時間及SQL Server的LOCK Wait Type。

## 4. 測試指標與度量標準
- **關鍵性能指標 (KPI)**：
    - CDC批次作業的總執行時間。
    - 線上姓名檢核API的平均響應時間（目標20秒以內）和成功率。
    - 系統資源使用情況（CPU、內存、磁碟IO）。
    - SQL Server資料庫的LOCK Wait Type次數及時間。
- **失敗準則**：
    - CDC批次作業未在預期時間內完成。
    - 線上API的響應時間超過20秒或出現高頻率的LOCK Wait Type。
    - 系統出現table lock或其他阻塞現象。

## 5. 測試結果與分析
- **數據展示**：
    - CDC批次作業的平均執行時間為40分鐘，優化後降低了10分鐘。
    - 線上姓名檢核API的平均響應時間為18秒，無LOCK Wait Type發生。
    - 系統資源利用率：CPU 80%，內存65%，磁碟IO達到18,500 IOPS。
    - SQL Server資料庫在測試期間未出現LOCK Wait Type，系統運行穩定。
- **結果分析**：
    - 優化後的自動結案預存程式顯著提高了CDC批次作業的執行效率。
    - 線上API的響應時間達標且系統資源利用率合理，無LOCK Wait Type出現，表明系統在高負載下仍能保持穩定運行。

## 6. 結論與建議
- **總結**：
    - 測試結果顯示CDC批次作業和線上API的性能在優化後均有顯著提升，特別是API響應時間和LOCK Wait Type方面的改進。
    - 系統在多任務並行運行下依然能夠維持穩定性，滿足營業中分行作業需求。
- **建議**：
    - 持續監控線上API的響應時間和LOCK Wait Type情況，確保在未來的系統更新或擴展時不出現性能問題。
    - 優化Pentaho ETL作業的資源配置，進一步提升CDC批次作業的效率。
    - 考慮升級伺服器硬體，以應對未來可能增加的負載。

## 7. 附錄
- **原始數據**：附上壓力測試中收集的系統日志、API響應時間和SQL Server的LOCK Wait Type數據文件。
- **配置檔案**：附上POSTMAN測試腳本及Pentaho的配置檔案。

此報告可供日後的系統性能優化及擴展參考，確保系統在各種工作負載下的穩定性。
