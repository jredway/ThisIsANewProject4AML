# 「國內反洗錢系統資料庫優化」架構檢視小組會議備忘錄

**日期:** [2024/08/30]

## 會議目標:
討論並確定 國內反洗錢系統資料庫 SQL Server 資料分割、歷史資料備存、檔案群組使用及硬體規格的策略，以優化系統效能。

## 背景:
本次會議旨在解決 國內反洗錢系統資料庫 SQL Server 管理中遇到的挑戰，重點在於高效的資料分割、備存和硬體資源的最佳化使用。會議還旨在確定 SQL Server 環境的最佳 CPU 和記憶體配置，考慮現有及預計的工作負載。

## 討論內容:

### 1. SQL Server 資料表分割作業
- 將符合歷史條件的資料表轉換並移動至存檔資料庫。
- 使用 Partition Switch 切離歷史資料，減少大量資料鎖定。
- 建議將需要的歷史資料儲存於分割的資料表，以提升查詢效能。

### 2. 歷史資料表備存作業
- 將歷史資料備存到專屬的資料庫，並在搬移前後進行資料檢核。
- 建議使用備份還原的方式進行歷史資料轉移，避免長時間停機。

### 3. 資料表與索引分割及多檔案群組啟用評估
- 在建立分區索引時，建議將索引與資料表分開存放至不同檔案群組。
- 針對每個資料表獨立設定分區功能，避免影響查詢效能。
- 檢討現有檔案群組配置，將分區資料存放至對應的檔案群組，以提升存取效能。
- 針對資料表的使用空間進行評估，考慮資料表大小是否超過一定容量，再決定是否啟用 filegroup 作業。

### 4. 硬體規格討論
- 針對 SQL Server 的使用情境，建議採用高時脈的多核心 CPU，以提升運算效能。
- 將資料表的熱資料部分儲存至記憶體，以減少讀寫延遲。
- 使用高時脈（3.5GHz 以上）和多核心的 CPU，如 Intel 的白金(Platinum)或黃金(Gold)系列，確保系統穩定運行。
- 雙路處理器建議使用兩顆 16 核心的設計，避免交換損耗並支持系統增長需求。
- 在同樣時脈和總核心數量一致的情況下，**2 個實體 CPU、45MB 快取記憶體** 的架構通常比 **4 個實體 CPU、22.5MB 快取記憶體** 更適合 SQL Server 建置，因為它能減少 NUMA 節點間的數據交換並提供更大的 L3 快取記憶體。
- 建議可評估使用高速 NVMe SSD 作為 TempDB 的存放裝置，提升資料庫操作效能。
- 網路配置部分，建議使用 25GbE 或以上的網卡，以確保資料傳輸速度。

## 行動項目:

### 1. 測試與驗證
- 在 POC 環境中進行初步測試與驗證，以確認所提議策略的可行性及效能提升效果。
- 在 9 月 20 日的下一次會議中報告測試結果。

### 2. 實施計劃
- 根據測試結果，最終確定資料分割、備存及硬體升級的實施計劃。

### 3. 後續會議
- 安排下一次會議，於 9 月 20 日審查測試結果並決定全面實施的時間表。
